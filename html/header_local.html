<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>底部导航</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../feature/fonts/iconfont.css" />
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            height: 100%;
            overflow: hidden;
        }
        /*框架*/

        #slip {
            transform: translate3d(0px, 0px, 0px);
        }

        .swipe-wrap {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .swipe {
            position: absolute;
            width: 100%;
            height: auto;
        }

        .swipe-box {
            width: 100%;
            overflow: hidden;
        }

        .video_max {
            display: block;
            width: 100%;
            height: 100%;
            z-index: 1;
            /*object-fit: fill;*/
            object-fit: cover;
        }

        #aui-header {
            background: -webkit-linear-gradient(rgba(0, 0, 0, 0.3), rgba(255, 255, 255, 0.1));
            /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(rgba(0, 0, 0, 0.3), rgba(255, 255, 255, 0.1));
            /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(rgba(0, 0, 0, 0.3), rgba(255, 255, 255, 0.1));
            /* Firefox 3.6 - 15 */
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(255, 255, 255, 0.1));
            /* 标准的语法 */
            position: fixed;
            top: 0
        }

        .swipe-box>#fixmessage_info {
            width: 3em;
            position: relative;
            right: 0;
            float: right;
            top: -22em;
            z-index: 3;
            height: 15em;
        }

        .swipe-box>#fixmessage_info>.username {
            margin: 0;
            float: right;
            margin-right: 0.25em;
            margin-bottom: 2em;
            right: 0;
            position: absolute;
        }

        .swipe-box>#fixmessage_info>.username>.userimg {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            border: 1px solid #fff;
            margin-right: 0;
        }

        .swipe-box>#fixmessage_info>.username>.alink_s {
            position: relative;
            background: red;
            border-radius: 50%;
            padding: 2px;
            padding-bottom: .1em;
            margin-top: .3em;
            width: 1em;
            height: 1em;
            text-align: center;
            color: #fff;
            top: -0.5em;
            right: -0.7em;
            display: table-cell;
            vertical-align: middle;
        }

        .swipe-box>#fixmessage_info>.username>.alink_s>.alink_s_action {
            width: 1rem;
            height: 1rem;
            position: absolute;
            top: -.225rem;
            left: -.1rem;
        }

        .swipe-box>#fixmessage_info>.link {
            position: absolute;
            right: 0;
            color: #fff;
            margin-top: 3.5em;
            text-align: center;
        }

        .swipe-box>#fixmessage_info>.link>.in_ac {
            position: absolute;
            text-align: center;
            right: 0.6em;
            font-size: x-large;
        }

        .swipe-box>#fixmessage_info>.link>.number_h {
            margin-top: 3em;
            text-align: center;
            right: 2.15em;
            font-size: x-small;
            position: absolute;
        }

        #aui-header>.aui-pull-left>.camera-text {
            font-size: 10px;
            padding-left: .5vh;
            padding-top: .5vh;
            font-family: '微软雅黑';
        }

        #aui-header>.aui-title>.aui-tab {
            background-color: rgba(0, 0, 0, 0);
        }

        #aui-header>.aui-title>.aui-tab>.aui-tab-item {
            color: #fff;
        }

        #aui-header>.aui-title>.aui-tab>.aui-active {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #fff;
        }

        #aui-header>.aui-title>.aui-tab>#page_aui {
            height: .9em;
            width: .2em;
            margin-top: .9em;
            background: #fff;
        }

        #showPlay {
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 45
        }

        #showPlay>span {
            margin-top: 60%;
            margin-left: 40%;
            line-height: 8vh;
            font-size: 5rem;
        }

        .play-video {
            position: relative;
            display: block;
            height: 100%;
            bottom: 100%;
            color: white;
            z-index: 4;
            background: rgba(0, 0, 0, 0.3);
            width: 100%;
            font-size: 10em;
        }

        .hide-video {
            display: none;
        }

        .show-video {
            display: block;
        }

        .icon-play:before {
            position: absolute;
            top: 1em;
            left: .6em;
        }
        #share{
          position: fixed;
          width: 100%;
          height: 5rem;
          bottom: 0;
          background: #fff;
          color: #000;
          z-index: 99;
          display: none;
        }
          #share>ul li{
            float: left;
          }
          .img_max{
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 98;
            display: block;
          }
    </style>

</head>

<body>
    <header id="aui-header" class="aui-bar aui-bar-nav">
        <div class="aui-pull-left aui-btn" onclick="openCamera()">
            <span class="aui-iconfont aui-icon-camera"></span>
            <span class="camera-text">随拍</span>
        </div>
        <div class="aui-title">
            <div class="aui-tab">
                <div class="aui-tab-item tapmode aui-active" onclick="switchLoading(this,'./header_local.html','home')">推荐</div>
                <span id="page_aui"></span>
                <div class="aui-tab-item tapmode" onclick="switchLoading(this,'./localList_win.html','localList')">广州</div>
            </div>
        </div>
        <div class="aui-pull-right aui-btn">
            <span class="aui-iconfont aui-icon-cart"></span> &nbsp; &nbsp; &nbsp;
            <span class="aui-iconfont aui-icon-video"></span> &nbsp;&nbsp;
        </div>
    </header>
    <div id="showPlay" style="display:none" onclick="showPlay()">
        <span class="iconfont icon-douyinkuaishou"></span>
    </div>
    <div class="swipe-wrap" id="slip">
        <article class="swipe">



        </article>
    </div>
    <div id="share_d" style="background-color:rgba(0,0,0,0.1);width:100%;height:100%;z-index:98;position:relative;top:0;display:none"></div>
<div id="share">
<section class="aui-grid">
            <div class="aui-row">
                <div class="aui-col-xs-4">
                    <i class="icon iconfont icon-facebook-logo"></i>
                    <!-- <div class="aui-grid-label">首页</div> -->
                </div>
                <div class="aui-col-xs-4">
                    <i class="icon iconfont icon-googleplus"></i>
                    <!-- <div class="aui-grid-label">设置</div> -->
                </div>
                <div class="aui-col-xs-4">
                    <i class="icon iconfont icon-twitter"></i>
                    <!-- <div class="aui-grid-label">地图</div> -->
                </div>
            </div>
</section>
</div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/slip.js"></script>
<script type="text/javascript">
    var container = document.getElementById('slip');
    var pages;
    var slip;
    var moveIsTrue = false;
    var userData = [{
        uid: new Date().getTime() + 1,
        imageUrl: '../image/suipai/suipai1.png',
        videoUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/abb9595e74647defe21d748e12f7a7c9.mp4',
    }, {
        uid: new Date().getTime() + 2,
        imageUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/1a73dd6a90a52b2aad1aafefbf977e4c.png',
        videoUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/00b2141bff87cfaa75498f66214aeb9e.mp4',
    }, {
        uid: new Date().getTime() + 3,
        imageUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/ec65083dbdc6bb18a6318591ac6c15a5.png',
        videoUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/9d9906ba474152307d7edca6bd72fbe2.mp4',
    }, {
        uid: new Date().getTime() + 4,
        imageUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/51fc1ddde9790c96a6986b74342a15e3.png',
        videoUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/dc811d2c4d88b409063c7ea2065fe6a0.mp4',
    }, {
        uid: new Date().getTime() + 5,
        imageUrl: 'http://7z2dc9.com1.z0.glb.clouddn.com/apicloud/51fc1ddde9790c96a6986b74342a15e3.png',
        videoUrl: '../res/src/test.mp4',
    }];
    var page = 0;
    userData.map(function(v, i) {
        var el = document.createElement('div');
        var el_child = document.createElement('video');
        var fix_message = document.createElement('ul');
        var fix_message_in = document.createElement('li');
        var fix_message_alink = document.createElement('div');
        var fix_message_repick = document.createElement('div');
        el.className = 'swipe-box';
        el_child.src = v.videoUrl;
        el_child.id = v.uid;
        el_child.poster = v.imageUrl;
        el_child.autoplay = true;
        el_child.loop = true;
        el_child.type='video/mp4';
        // el_child.setAttribute('onclick','showPlay(this)');
        el_child.muted  = true;
        el_child.setAttribute('playsinline', 'true');
        el_child.setAttribute('webkit-playsinline', 'true');
        el_child.setAttribute('x5-video-player-type',"h5")
         el_child.setAttribute('x5-video-player-fullscreen',"portraint")
         el_child.setAttribute('webkit-playsinline',"true")
         el_child.setAttribute('playsinline',"true" )
         el_child.setAttribute('raw-controls',"true")
          el_child.setAttribute('x-webkit-airplay',"true")
           el_child.setAttribute('x5-video-orientation',"portraint")
        el_child.className = 'video_max';
        fix_message.id = "fixmessage_info";
        fix_message_in.className = "username";
        el_child.codecs="avc1.42E01E, mp4a.40.2"
        // fix_message.style.top = 15 + (i * 35) + 'em';
        fix_message_in.innerHTML = '<div style="background:url(' + v.imageUrl + ') 40% 45%" class="userimg"></div><span class="alink_s"><span class="alink_s_action">+</span></span>'
        fix_message_alink.className = "link";
        fix_message_alink.innerHTML = "<span class='icon iconfont icon-fenxiang11 in_ac'></span>"
        // fix_message_alink.setAttribute('onclick','onenShare()')
        // var img = document.createElement('img');
        // img.id = 'imgs';
        // img.className = 'img_max';
        fix_message.appendChild(fix_message_in)
        fix_message.appendChild(fix_message_alink)
        fix_message.appendChild(fix_message_repick)
        // el.appendChild(img);
        el.appendChild(el_child);
        var i_el = document.createElement('i');
        i_el.className = 'play-video hide-video icon iconfont icon-play';
        el.appendChild(fix_message);
        el.appendChild(i_el);
        // el_child.onclick='this.paused = !this.paused';
        // el_child.onclick='showC(this)';
        // el.onclick='showC(this)';
        container.querySelector('.swipe').appendChild(el);
    })
    pages = document.querySelectorAll('.swipe-box');
    // console.log(JSON.stringify(pages[0].querySelector('#fixmessage_info').getElementsByTagName('div').length))
    document.getElementById(userData[0].uid).play();
    document.getElementById(userData[this.page].uid).muted = false;
    // document.getElementById(userData[this.page].uid).play();
    // setTimeout(function(){pages[0].querySelector('.img_max').style.display = 'none'},2000);
    // setTimeout(function(){document.getElementById(userData[0].uid).pause()},40);
    // setTimeout(function(){document.getElementById(userData[0].uid).play()},60);
    slip = Slip(container, 'y').webapp(pages);
    var link_list = document.querySelectorAll('.link');
    console.log(JSON.stringify(link_list));
    link_list.map(function(els,index){
      if(checkPC()){
         $api.rmEvt(els, 'click', onenShare);
        }else{
          $api.rmEvt(els, 'tap',onenShare );
        }
      })
    function showPlay(d) {
        // document.getElementById('showPlay').style.display = 'none';
        // document.getElementById(userData[page].uid).play();
        if (!d.paused) {
            d.pause();
            d.nextSibling.className.replace('hide-video', 'show-video');
        } else {
            d.play();
            d.nextSibling.className.replace('show-video', 'hide-video');
        }
    }
    var cocoVideo;
    var params = {
        mode: 'all',
        min_time: '1',
        max_time: '15',
        img_num: '1'
    };
    function checkPC() {
  var userAgentInfo=navigator.userAgent;
  var Agents =new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod");
  var flag=true;
  for(var v=0;v<Agents.length;v++) {
     if(userAgentInfo.indexOf(Agents[v])>0) {
       flag=false;
       break;
     }
   }
   return flag;
  }
    apiready = function() {
            api.parseTapmode();
            var header = $api.byId('aui-header');
            $api.fixStatusBar(header);
            // slip._onTouchEnd();

            // cocoVideo = api.require('cocoVideo');
            // cocoVideo.config(params, function(ret) {
            //     if (ret.status == 'error') {
            //         alert(ret.msg);
            //     }
            // });
            slip.start(function(event) {
                    // console.log('start');
                    // console.log(JSON.stringify(this));
                    page = this.page;
                    // 事件对象
                    moveIsTrue = false;
                    // 当前坐标值
                    // console.log(JSON.stringify(userData[this.page]));
                    // if (!document.getElementById(userData[this.page].uid).paused)
                    // document.getElementById(userData[this.page].uid).pause();
                })
                .move(function(event) {
                    // console.log('move');
                    moveIsTrue = true;
                    // console.log(JSON.stringify(this));
                })
                .end(function() {

                    // console.log(JSON.stringify(this));

                    if (this.finger == null) {
                        if (document.getElementById(userData[this.page].uid).paused) {
                            document.getElementById(userData[this.page].uid).play();
                            document.getElementById(userData[this.page].uid).pause();
                            document.getElementById(userData[this.page].uid).play();
                            document.getElementById(userData[this.page].uid).muted = false;
                            $api.removeCls(pages[this.page].querySelector('.play-video'), 'show-video');
                            $api.addCls(pages[this.page].querySelector('.play-video'), 'hide-video');
                        } else {
                            document.getElementById(userData[this.page].uid).pause();
                            console.log(JSON.stringify($api.hasCls(pages[this.page].querySelector('.play-video'), 'hide-video')));
                            $api.removeCls(pages[this.page].querySelector('.play-video'), 'hide-video');
                            $api.addCls(pages[this.page].querySelector('.play-video'), 'show-video');
                            console.log(JSON.stringify($api.hasCls(pages[this.page].querySelector('.play-video'), 'hide-video')));
                        }
                        return false;
                    } else {
                        document.getElementById(userData[page].uid).pause();
                        page = this.page;
                        // document.getElementById(userData[this.page].uid).play();
                        document.getElementById(userData[this.page].uid).muted = false;
                        document.getElementById(userData[this.page].uid).pause();
                        document.getElementById(userData[this.page].uid).play();

                    }

                    // console.log('end');
                    // console.log(JSON.stringify(this.page));
                    // if (document.getElementById(userData[this.page].uid).paused) {
                    //     document.getElementById(userData[this.page].uid).play();
                    // }else{
                    //   document.getElementById(userData[this.page].uid).pause();
                    // }
                    // 滑动方向
                    // console.log(this.orient);
                });
            // api.addEventListener({
            //     name: 'tap'
            // }, function(ret, err) {
            //     // console.log(JSON.stringify(document.getElementById(userData[page].uid)))
            //
            //     if (document.getElementById(userData[page].uid).paused) {
            //         document.getElementById(userData[page].uid).controls = false;
            //         document.getElementById(userData[page].uid).play();
            //         //  document.getElementById('showPlay').style.display = 'none';
            //     } else {
            //       console.error(JSON.stringify(!document.getElementById(userData[page].uid).paused));
            //         document.getElementById(userData[page].uid).controls = true;
            //         document.getElementById(userData[page].uid).pause();
            //         //  document.getElementById('showPlay').style.display = 'block';
            //
            //     }
            // });
        }
        // document.querySelector('.swipe-box').addEventListener('click',function(e){
        //   console.log(JSON.stringify(e),JSON.stringify(this.children[0]));
        //
        // })
    function showC(d) {
        // console.log(d.childNode)
        d.controls = true;
        d.paused = !d.pasused;
    }
    function onenShare(){
      var share_d = document.getElementById('share_d');
      var share = document.getElementById('share');
      if(share_d.style.display == 'none'){
        share_d.style.display = 'block';
        share.style.display = 'block';
      }else{
        share_d.style.display="none";
        share.style.display = 'none';
      }
    }
    function switchLoading(obj, url, text) {
        var frames = api.frames();
        var header = $api.byId('aui-header');
        var param = api.pageParam;
        var headerPos = $api.offset(header);
        var body_h = api.frameHeight;
        var footer_h = param.height;
        var headerAct = $api.dom(header, '.aui-active');
        console.log(JSON.stringify(headerAct.length))
        $api.removeCls(headerAct, 'aui-active');
        $api.addCls(obj, 'aui-active');
        for (var i = 0; i < frames.length; i++) {
            if (frames[i].name == text) {
                api.bringFrameToFront({
                    from: text
                });
                return;
            }
        }
        api.openFrame({
            name: text,
            url: url,
            rect: {
                x: 0,
                y: 0,
                w: 'auto',
                h: body_h
            },
            pageParam: {
                top: headerPos.h,
                height: body_h - headerPos.h - footer_h,
                name: text,
                parentsname: api.pageParam.name
            },
            bounces: false,
            bgColor: 'rgba(0,0,0,0)',
            vScrollBarEnabled: true,
            hScrollBarEnabled: true
        });
        setTimeout(function() {
            var frames = api.frames();
            console.log(JSON.stringify(frames))
                // for (var i = 0; i < frames.length; i++) {
            api.bringFrameToFront({
                from: text
            });
            // api.setFrameAttr({
            //     // from: text,
            //     name:api.pageParam.name,
            //     hidden:true
            // });
            console.log(JSON.stringify(param.name))
                // }
        }, 1000)
    }

    function openCamera() {
        var param = {
            resolutionMode: 2,
            ratioMode: 1,
            recordMode: 3,
            beautyStatus: true,
            beautyLevel: 80,
            isCameraBack: false,
            isNeedClip: true,
            minDuration: 2,
            maxDuration: 30,
            videoQuality: 2,
            gop: 5,
            frameRate: 25
        };
        var demo = api.require('quPaiModule');
        demo.record(param, function(ret, err) {
            console.log(JSON.stringify(ret))
            if (ret) {
                api.openWin({
                    name: 'addmyinfo',
                    url: './addMyimageInfo_win.html',
                    pageParam: {
                        img: ret.thumbnailPath,
                        video: ret.videoPath
                    }
                });

                ret.videoPath;
                ret.image_path;
            }
            if (err) {
                alert(err.msg);
            }
        });
      }
</script>
